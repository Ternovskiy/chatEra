import{a as mi}from"./chunk-5LG3L7J4.js";import{a as R,b as K,c as B,d as F}from"./chunk-4P7JCS3O.js";var bt=B(()=>{"use strict"});var Lt=B(()=>{"use strict"});var kt=B(()=>{"use strict"});var Tt=B(()=>{"use strict"});var Ot=B(Se=>{"use strict";Se.byteLength=vi;Se.toByteArray=wi;Se.fromByteArray=Si;var M=[],N=[],yi=typeof Uint8Array<"u"?Uint8Array:Array,Ye="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(X=0,Ct=Ye.length;X<Ct;++X)M[X]=Ye[X],N[Ye.charCodeAt(X)]=X;var X,Ct;N[45]=62;N[95]=63;function Bt(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var i=t===e?0:4-t%4;return[t,i]}function vi(r){var e=Bt(r),t=e[0],i=e[1];return(t+i)*3/4-i}function gi(r,e,t){return(e+t)*3/4-t}function wi(r){var e,t=Bt(r),i=t[0],n=t[1],s=new yi(gi(r,i,n)),o=0,a=n>0?i-4:i,u;for(u=0;u<a;u+=4)e=N[r.charCodeAt(u)]<<18|N[r.charCodeAt(u+1)]<<12|N[r.charCodeAt(u+2)]<<6|N[r.charCodeAt(u+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return n===2&&(e=N[r.charCodeAt(u)]<<2|N[r.charCodeAt(u+1)]>>4,s[o++]=e&255),n===1&&(e=N[r.charCodeAt(u)]<<10|N[r.charCodeAt(u+1)]<<4|N[r.charCodeAt(u+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function xi(r){return M[r>>18&63]+M[r>>12&63]+M[r>>6&63]+M[r&63]}function Ei(r,e,t){for(var i,n=[],s=e;s<t;s+=3)i=(r[s]<<16&16711680)+(r[s+1]<<8&65280)+(r[s+2]&255),n.push(xi(i));return n.join("")}function Si(r){for(var e,t=r.length,i=t%3,n=[],s=16383,o=0,a=t-i;o<a;o+=s)n.push(Ei(r,o,o+s>a?a:o+s));return i===1?(e=r[t-1],n.push(M[e>>2]+M[e<<4&63]+"==")):i===2&&(e=(r[t-2]<<8)+r[t-1],n.push(M[e>>10]+M[e>>4&63]+M[e<<2&63]+"=")),n.join("")}});var Ft=B(ze=>{"use strict";ze.read=function(r,e,t,i,n){var s,o,a=n*8-i-1,u=(1<<a)-1,l=u>>1,h=-7,c=t?n-1:0,m=t?-1:1,p=r[e+c];for(c+=m,s=p&(1<<-h)-1,p>>=-h,h+=a;h>0;s=s*256+r[e+c],c+=m,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=i;h>0;o=o*256+r[e+c],c+=m,h-=8);if(s===0)s=1-l;else{if(s===u)return o?NaN:(p?-1:1)*(1/0);o=o+Math.pow(2,i),s=s-l}return(p?-1:1)*o*Math.pow(2,s-i)};ze.write=function(r,e,t,i,n,s){var o,a,u,l=s*8-n-1,h=(1<<l)-1,c=h>>1,m=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:s-1,y=i?1:-1,d=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=h):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),o+c>=1?e+=m/u:e+=m*Math.pow(2,1-c),e*u>=2&&(o++,u/=2),o+c>=h?(a=0,o=h):o+c>=1?(a=(e*u-1)*Math.pow(2,n),o=o+c):(a=e*Math.pow(2,c-1)*Math.pow(2,n),o=0));n>=8;r[t+p]=a&255,p+=y,a/=256,n-=8);for(o=o<<n|a,l+=n;l>0;r[t+p]=o&255,p+=y,o/=256,l-=8);r[t+p-y]|=d*128}});var Vt=B(se=>{"use strict";var Ke=Ot(),ne=Ft(),Ut=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;se.Buffer=f;se.SlowBuffer=Bi;se.INSPECT_MAX_BYTES=50;var be=2147483647;se.kMaxLength=be;f.TYPED_ARRAY_SUPPORT=bi();!f.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function bi(){try{var r=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(r,e),r.foo()===42}catch{return!1}}Object.defineProperty(f.prototype,"parent",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.buffer}});Object.defineProperty(f.prototype,"offset",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.byteOffset}});function W(r){if(r>be)throw new RangeError('The value "'+r+'" is invalid for option "size"');var e=new Uint8Array(r);return Object.setPrototypeOf(e,f.prototype),e}function f(r,e,t){if(typeof r=="number"){if(typeof e=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return Qe(r)}return It(r,e,t)}f.poolSize=8192;function It(r,e,t){if(typeof r=="string")return ki(r,e);if(ArrayBuffer.isView(r))return Ti(r);if(r==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r);if(P(r,ArrayBuffer)||r&&P(r.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(P(r,SharedArrayBuffer)||r&&P(r.buffer,SharedArrayBuffer)))return Ze(r,e,t);if(typeof r=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var i=r.valueOf&&r.valueOf();if(i!=null&&i!==r)return f.from(i,e,t);var n=Ci(r);if(n)return n;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof r[Symbol.toPrimitive]=="function")return f.from(r[Symbol.toPrimitive]("string"),e,t);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r)}f.from=function(r,e,t){return It(r,e,t)};Object.setPrototypeOf(f.prototype,Uint8Array.prototype);Object.setPrototypeOf(f,Uint8Array);function Rt(r){if(typeof r!="number")throw new TypeError('"size" argument must be of type number');if(r<0)throw new RangeError('The value "'+r+'" is invalid for option "size"')}function Li(r,e,t){return Rt(r),r<=0?W(r):e!==void 0?typeof t=="string"?W(r).fill(e,t):W(r).fill(e):W(r)}f.alloc=function(r,e,t){return Li(r,e,t)};function Qe(r){return Rt(r),W(r<0?0:et(r)|0)}f.allocUnsafe=function(r){return Qe(r)};f.allocUnsafeSlow=function(r){return Qe(r)};function ki(r,e){if((typeof e!="string"||e==="")&&(e="utf8"),!f.isEncoding(e))throw new TypeError("Unknown encoding: "+e);var t=Mt(r,e)|0,i=W(t),n=i.write(r,e);return n!==t&&(i=i.slice(0,n)),i}function Xe(r){for(var e=r.length<0?0:et(r.length)|0,t=W(e),i=0;i<e;i+=1)t[i]=r[i]&255;return t}function Ti(r){if(P(r,Uint8Array)){var e=new Uint8Array(r);return Ze(e.buffer,e.byteOffset,e.byteLength)}return Xe(r)}function Ze(r,e,t){if(e<0||r.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(r.byteLength<e+(t||0))throw new RangeError('"length" is outside of buffer bounds');var i;return e===void 0&&t===void 0?i=new Uint8Array(r):t===void 0?i=new Uint8Array(r,e):i=new Uint8Array(r,e,t),Object.setPrototypeOf(i,f.prototype),i}function Ci(r){if(f.isBuffer(r)){var e=et(r.length)|0,t=W(e);return t.length===0||r.copy(t,0,0,e),t}if(r.length!==void 0)return typeof r.length!="number"||tt(r.length)?W(0):Xe(r);if(r.type==="Buffer"&&Array.isArray(r.data))return Xe(r.data)}function et(r){if(r>=be)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+be.toString(16)+" bytes");return r|0}function Bi(r){return+r!=r&&(r=0),f.alloc(+r)}f.isBuffer=function(e){return e!=null&&e._isBuffer===!0&&e!==f.prototype};f.compare=function(e,t){if(P(e,Uint8Array)&&(e=f.from(e,e.offset,e.byteLength)),P(t,Uint8Array)&&(t=f.from(t,t.offset,t.byteLength)),!f.isBuffer(e)||!f.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var i=e.length,n=t.length,s=0,o=Math.min(i,n);s<o;++s)if(e[s]!==t[s]){i=e[s],n=t[s];break}return i<n?-1:n<i?1:0};f.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};f.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return f.alloc(0);var i;if(t===void 0)for(t=0,i=0;i<e.length;++i)t+=e[i].length;var n=f.allocUnsafe(t),s=0;for(i=0;i<e.length;++i){var o=e[i];if(P(o,Uint8Array))s+o.length>n.length?f.from(o).copy(n,s):Uint8Array.prototype.set.call(n,o,s);else if(f.isBuffer(o))o.copy(n,s);else throw new TypeError('"list" argument must be an Array of Buffers');s+=o.length}return n};function Mt(r,e){if(f.isBuffer(r))return r.length;if(ArrayBuffer.isView(r)||P(r,ArrayBuffer))return r.byteLength;if(typeof r!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof r);var t=r.length,i=arguments.length>2&&arguments[2]===!0;if(!i&&t===0)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":return Je(r).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return t*2;case"hex":return t>>>1;case"base64":return Gt(r).length;default:if(n)return i?-1:Je(r).length;e=(""+e).toLowerCase(),n=!0}}f.byteLength=Mt;function Oi(r,e,t){var i=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((t===void 0||t>this.length)&&(t=this.length),t<=0)||(t>>>=0,e>>>=0,t<=e))return"";for(r||(r="utf8");;)switch(r){case"hex":return Di(this,e,t);case"utf8":case"utf-8":return $t(this,e,t);case"ascii":return Pi(this,e,t);case"latin1":case"binary":return $i(this,e,t);case"base64":return Ri(this,e,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Wi(this,e,t);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(r+"").toLowerCase(),i=!0}}f.prototype._isBuffer=!0;function Z(r,e,t){var i=r[e];r[e]=r[t],r[t]=i}f.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)Z(this,t,t+1);return this};f.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)Z(this,t,t+3),Z(this,t+1,t+2);return this};f.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)Z(this,t,t+7),Z(this,t+1,t+6),Z(this,t+2,t+5),Z(this,t+3,t+4);return this};f.prototype.toString=function(){var e=this.length;return e===0?"":arguments.length===0?$t(this,0,e):Oi.apply(this,arguments)};f.prototype.toLocaleString=f.prototype.toString;f.prototype.equals=function(e){if(!f.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:f.compare(this,e)===0};f.prototype.inspect=function(){var e="",t=se.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"};Ut&&(f.prototype[Ut]=f.prototype.inspect);f.prototype.compare=function(e,t,i,n,s){if(P(e,Uint8Array)&&(e=f.from(e,e.offset,e.byteLength)),!f.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(t===void 0&&(t=0),i===void 0&&(i=e?e.length:0),n===void 0&&(n=0),s===void 0&&(s=this.length),t<0||i>e.length||n<0||s>this.length)throw new RangeError("out of range index");if(n>=s&&t>=i)return 0;if(n>=s)return-1;if(t>=i)return 1;if(t>>>=0,i>>>=0,n>>>=0,s>>>=0,this===e)return 0;for(var o=s-n,a=i-t,u=Math.min(o,a),l=this.slice(n,s),h=e.slice(t,i),c=0;c<u;++c)if(l[c]!==h[c]){o=l[c],a=h[c];break}return o<a?-1:a<o?1:0};function Pt(r,e,t,i,n){if(r.length===0)return-1;if(typeof t=="string"?(i=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t=+t,tt(t)&&(t=n?0:r.length-1),t<0&&(t=r.length+t),t>=r.length){if(n)return-1;t=r.length-1}else if(t<0)if(n)t=0;else return-1;if(typeof e=="string"&&(e=f.from(e,i)),f.isBuffer(e))return e.length===0?-1:Nt(r,e,t,i,n);if(typeof e=="number")return e=e&255,typeof Uint8Array.prototype.indexOf=="function"?n?Uint8Array.prototype.indexOf.call(r,e,t):Uint8Array.prototype.lastIndexOf.call(r,e,t):Nt(r,[e],t,i,n);throw new TypeError("val must be string, number or Buffer")}function Nt(r,e,t,i,n){var s=1,o=r.length,a=e.length;if(i!==void 0&&(i=String(i).toLowerCase(),i==="ucs2"||i==="ucs-2"||i==="utf16le"||i==="utf-16le")){if(r.length<2||e.length<2)return-1;s=2,o/=2,a/=2,t/=2}function u(p,y){return s===1?p[y]:p.readUInt16BE(y*s)}var l;if(n){var h=-1;for(l=t;l<o;l++)if(u(r,l)===u(e,h===-1?0:l-h)){if(h===-1&&(h=l),l-h+1===a)return h*s}else h!==-1&&(l-=l-h),h=-1}else for(t+a>o&&(t=o-a),l=t;l>=0;l--){for(var c=!0,m=0;m<a;m++)if(u(r,l+m)!==u(e,m)){c=!1;break}if(c)return l}return-1}f.prototype.includes=function(e,t,i){return this.indexOf(e,t,i)!==-1};f.prototype.indexOf=function(e,t,i){return Pt(this,e,t,i,!0)};f.prototype.lastIndexOf=function(e,t,i){return Pt(this,e,t,i,!1)};function Fi(r,e,t,i){t=Number(t)||0;var n=r.length-t;i?(i=Number(i),i>n&&(i=n)):i=n;var s=e.length;i>s/2&&(i=s/2);for(var o=0;o<i;++o){var a=parseInt(e.substr(o*2,2),16);if(tt(a))return o;r[t+o]=a}return o}function Ui(r,e,t,i){return Le(Je(e,r.length-t),r,t,i)}function Ni(r,e,t,i){return Le(Vi(e),r,t,i)}function Ai(r,e,t,i){return Le(Gt(e),r,t,i)}function Ii(r,e,t,i){return Le(qi(e,r.length-t),r,t,i)}f.prototype.write=function(e,t,i,n){if(t===void 0)n="utf8",i=this.length,t=0;else if(i===void 0&&typeof t=="string")n=t,i=this.length,t=0;else if(isFinite(t))t=t>>>0,isFinite(i)?(i=i>>>0,n===void 0&&(n="utf8")):(n=i,i=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var s=this.length-t;if((i===void 0||i>s)&&(i=s),e.length>0&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return Fi(this,e,t,i);case"utf8":case"utf-8":return Ui(this,e,t,i);case"ascii":case"latin1":case"binary":return Ni(this,e,t,i);case"base64":return Ai(this,e,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ii(this,e,t,i);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}};f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Ri(r,e,t){return e===0&&t===r.length?Ke.fromByteArray(r):Ke.fromByteArray(r.slice(e,t))}function $t(r,e,t){t=Math.min(r.length,t);for(var i=[],n=e;n<t;){var s=r[n],o=null,a=s>239?4:s>223?3:s>191?2:1;if(n+a<=t){var u,l,h,c;switch(a){case 1:s<128&&(o=s);break;case 2:u=r[n+1],(u&192)===128&&(c=(s&31)<<6|u&63,c>127&&(o=c));break;case 3:u=r[n+1],l=r[n+2],(u&192)===128&&(l&192)===128&&(c=(s&15)<<12|(u&63)<<6|l&63,c>2047&&(c<55296||c>57343)&&(o=c));break;case 4:u=r[n+1],l=r[n+2],h=r[n+3],(u&192)===128&&(l&192)===128&&(h&192)===128&&(c=(s&15)<<18|(u&63)<<12|(l&63)<<6|h&63,c>65535&&c<1114112&&(o=c))}}o===null?(o=65533,a=1):o>65535&&(o-=65536,i.push(o>>>10&1023|55296),o=56320|o&1023),i.push(o),n+=a}return Mi(i)}var At=4096;function Mi(r){var e=r.length;if(e<=At)return String.fromCharCode.apply(String,r);for(var t="",i=0;i<e;)t+=String.fromCharCode.apply(String,r.slice(i,i+=At));return t}function Pi(r,e,t){var i="";t=Math.min(r.length,t);for(var n=e;n<t;++n)i+=String.fromCharCode(r[n]&127);return i}function $i(r,e,t){var i="";t=Math.min(r.length,t);for(var n=e;n<t;++n)i+=String.fromCharCode(r[n]);return i}function Di(r,e,t){var i=r.length;(!e||e<0)&&(e=0),(!t||t<0||t>i)&&(t=i);for(var n="",s=e;s<t;++s)n+=Hi[r[s]];return n}function Wi(r,e,t){for(var i=r.slice(e,t),n="",s=0;s<i.length-1;s+=2)n+=String.fromCharCode(i[s]+i[s+1]*256);return n}f.prototype.slice=function(e,t){var i=this.length;e=~~e,t=t===void 0?i:~~t,e<0?(e+=i,e<0&&(e=0)):e>i&&(e=i),t<0?(t+=i,t<0&&(t=0)):t>i&&(t=i),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,f.prototype),n};function S(r,e,t){if(r%1!==0||r<0)throw new RangeError("offset is not uint");if(r+e>t)throw new RangeError("Trying to access beyond buffer length")}f.prototype.readUintLE=f.prototype.readUIntLE=function(e,t,i){e=e>>>0,t=t>>>0,i||S(e,t,this.length);for(var n=this[e],s=1,o=0;++o<t&&(s*=256);)n+=this[e+o]*s;return n};f.prototype.readUintBE=f.prototype.readUIntBE=function(e,t,i){e=e>>>0,t=t>>>0,i||S(e,t,this.length);for(var n=this[e+--t],s=1;t>0&&(s*=256);)n+=this[e+--t]*s;return n};f.prototype.readUint8=f.prototype.readUInt8=function(e,t){return e=e>>>0,t||S(e,1,this.length),this[e]};f.prototype.readUint16LE=f.prototype.readUInt16LE=function(e,t){return e=e>>>0,t||S(e,2,this.length),this[e]|this[e+1]<<8};f.prototype.readUint16BE=f.prototype.readUInt16BE=function(e,t){return e=e>>>0,t||S(e,2,this.length),this[e]<<8|this[e+1]};f.prototype.readUint32LE=f.prototype.readUInt32LE=function(e,t){return e=e>>>0,t||S(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216};f.prototype.readUint32BE=f.prototype.readUInt32BE=function(e,t){return e=e>>>0,t||S(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])};f.prototype.readIntLE=function(e,t,i){e=e>>>0,t=t>>>0,i||S(e,t,this.length);for(var n=this[e],s=1,o=0;++o<t&&(s*=256);)n+=this[e+o]*s;return s*=128,n>=s&&(n-=Math.pow(2,8*t)),n};f.prototype.readIntBE=function(e,t,i){e=e>>>0,t=t>>>0,i||S(e,t,this.length);for(var n=t,s=1,o=this[e+--n];n>0&&(s*=256);)o+=this[e+--n]*s;return s*=128,o>=s&&(o-=Math.pow(2,8*t)),o};f.prototype.readInt8=function(e,t){return e=e>>>0,t||S(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]};f.prototype.readInt16LE=function(e,t){e=e>>>0,t||S(e,2,this.length);var i=this[e]|this[e+1]<<8;return i&32768?i|4294901760:i};f.prototype.readInt16BE=function(e,t){e=e>>>0,t||S(e,2,this.length);var i=this[e+1]|this[e]<<8;return i&32768?i|4294901760:i};f.prototype.readInt32LE=function(e,t){return e=e>>>0,t||S(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24};f.prototype.readInt32BE=function(e,t){return e=e>>>0,t||S(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]};f.prototype.readFloatLE=function(e,t){return e=e>>>0,t||S(e,4,this.length),ne.read(this,e,!0,23,4)};f.prototype.readFloatBE=function(e,t){return e=e>>>0,t||S(e,4,this.length),ne.read(this,e,!1,23,4)};f.prototype.readDoubleLE=function(e,t){return e=e>>>0,t||S(e,8,this.length),ne.read(this,e,!0,52,8)};f.prototype.readDoubleBE=function(e,t){return e=e>>>0,t||S(e,8,this.length),ne.read(this,e,!1,52,8)};function O(r,e,t,i,n,s){if(!f.isBuffer(r))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>n||e<s)throw new RangeError('"value" argument is out of bounds');if(t+i>r.length)throw new RangeError("Index out of range")}f.prototype.writeUintLE=f.prototype.writeUIntLE=function(e,t,i,n){if(e=+e,t=t>>>0,i=i>>>0,!n){var s=Math.pow(2,8*i)-1;O(this,e,t,i,s,0)}var o=1,a=0;for(this[t]=e&255;++a<i&&(o*=256);)this[t+a]=e/o&255;return t+i};f.prototype.writeUintBE=f.prototype.writeUIntBE=function(e,t,i,n){if(e=+e,t=t>>>0,i=i>>>0,!n){var s=Math.pow(2,8*i)-1;O(this,e,t,i,s,0)}var o=i-1,a=1;for(this[t+o]=e&255;--o>=0&&(a*=256);)this[t+o]=e/a&255;return t+i};f.prototype.writeUint8=f.prototype.writeUInt8=function(e,t,i){return e=+e,t=t>>>0,i||O(this,e,t,1,255,0),this[t]=e&255,t+1};f.prototype.writeUint16LE=f.prototype.writeUInt16LE=function(e,t,i){return e=+e,t=t>>>0,i||O(this,e,t,2,65535,0),this[t]=e&255,this[t+1]=e>>>8,t+2};f.prototype.writeUint16BE=f.prototype.writeUInt16BE=function(e,t,i){return e=+e,t=t>>>0,i||O(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=e&255,t+2};f.prototype.writeUint32LE=f.prototype.writeUInt32LE=function(e,t,i){return e=+e,t=t>>>0,i||O(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e&255,t+4};f.prototype.writeUint32BE=f.prototype.writeUInt32BE=function(e,t,i){return e=+e,t=t>>>0,i||O(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};f.prototype.writeIntLE=function(e,t,i,n){if(e=+e,t=t>>>0,!n){var s=Math.pow(2,8*i-1);O(this,e,t,i,s-1,-s)}var o=0,a=1,u=0;for(this[t]=e&255;++o<i&&(a*=256);)e<0&&u===0&&this[t+o-1]!==0&&(u=1),this[t+o]=(e/a>>0)-u&255;return t+i};f.prototype.writeIntBE=function(e,t,i,n){if(e=+e,t=t>>>0,!n){var s=Math.pow(2,8*i-1);O(this,e,t,i,s-1,-s)}var o=i-1,a=1,u=0;for(this[t+o]=e&255;--o>=0&&(a*=256);)e<0&&u===0&&this[t+o+1]!==0&&(u=1),this[t+o]=(e/a>>0)-u&255;return t+i};f.prototype.writeInt8=function(e,t,i){return e=+e,t=t>>>0,i||O(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=e&255,t+1};f.prototype.writeInt16LE=function(e,t,i){return e=+e,t=t>>>0,i||O(this,e,t,2,32767,-32768),this[t]=e&255,this[t+1]=e>>>8,t+2};f.prototype.writeInt16BE=function(e,t,i){return e=+e,t=t>>>0,i||O(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=e&255,t+2};f.prototype.writeInt32LE=function(e,t,i){return e=+e,t=t>>>0,i||O(this,e,t,4,2147483647,-2147483648),this[t]=e&255,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4};f.prototype.writeInt32BE=function(e,t,i){return e=+e,t=t>>>0,i||O(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};function Dt(r,e,t,i,n,s){if(t+i>r.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function Wt(r,e,t,i,n){return e=+e,t=t>>>0,n||Dt(r,e,t,4,34028234663852886e22,-34028234663852886e22),ne.write(r,e,t,i,23,4),t+4}f.prototype.writeFloatLE=function(e,t,i){return Wt(this,e,t,!0,i)};f.prototype.writeFloatBE=function(e,t,i){return Wt(this,e,t,!1,i)};function jt(r,e,t,i,n){return e=+e,t=t>>>0,n||Dt(r,e,t,8,17976931348623157e292,-17976931348623157e292),ne.write(r,e,t,i,52,8),t+8}f.prototype.writeDoubleLE=function(e,t,i){return jt(this,e,t,!0,i)};f.prototype.writeDoubleBE=function(e,t,i){return jt(this,e,t,!1,i)};f.prototype.copy=function(e,t,i,n){if(!f.isBuffer(e))throw new TypeError("argument should be a Buffer");if(i||(i=0),!n&&n!==0&&(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<i&&(n=i),n===i||e.length===0||this.length===0)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-i&&(n=e.length-t+i);var s=n-i;return this===e&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(t,i,n):Uint8Array.prototype.set.call(e,this.subarray(i,n),t),s};f.prototype.fill=function(e,t,i,n){if(typeof e=="string"){if(typeof t=="string"?(n=t,t=0,i=this.length):typeof i=="string"&&(n=i,i=this.length),n!==void 0&&typeof n!="string")throw new TypeError("encoding must be a string");if(typeof n=="string"&&!f.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(e.length===1){var s=e.charCodeAt(0);(n==="utf8"&&s<128||n==="latin1")&&(e=s)}}else typeof e=="number"?e=e&255:typeof e=="boolean"&&(e=Number(e));if(t<0||this.length<t||this.length<i)throw new RangeError("Out of range index");if(i<=t)return this;t=t>>>0,i=i===void 0?this.length:i>>>0,e||(e=0);var o;if(typeof e=="number")for(o=t;o<i;++o)this[o]=e;else{var a=f.isBuffer(e)?e:f.from(e,n),u=a.length;if(u===0)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<i-t;++o)this[o+t]=a[o%u]}return this};var ji=/[^+/0-9A-Za-z-_]/g;function Gi(r){if(r=r.split("=")[0],r=r.trim().replace(ji,""),r.length<2)return"";for(;r.length%4!==0;)r=r+"=";return r}function Je(r,e){e=e||1/0;for(var t,i=r.length,n=null,s=[],o=0;o<i;++o){if(t=r.charCodeAt(o),t>55295&&t<57344){if(!n){if(t>56319){(e-=3)>-1&&s.push(239,191,189);continue}else if(o+1===i){(e-=3)>-1&&s.push(239,191,189);continue}n=t;continue}if(t<56320){(e-=3)>-1&&s.push(239,191,189),n=t;continue}t=(n-55296<<10|t-56320)+65536}else n&&(e-=3)>-1&&s.push(239,191,189);if(n=null,t<128){if((e-=1)<0)break;s.push(t)}else if(t<2048){if((e-=2)<0)break;s.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;s.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;s.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return s}function Vi(r){for(var e=[],t=0;t<r.length;++t)e.push(r.charCodeAt(t)&255);return e}function qi(r,e){for(var t,i,n,s=[],o=0;o<r.length&&!((e-=2)<0);++o)t=r.charCodeAt(o),i=t>>8,n=t%256,s.push(n),s.push(i);return s}function Gt(r){return Ke.toByteArray(Gi(r))}function Le(r,e,t,i){for(var n=0;n<i&&!(n+t>=e.length||n>=r.length);++n)e[n+t]=r[n];return n}function P(r,e){return r instanceof e||r!=null&&r.constructor!=null&&r.constructor.name!=null&&r.constructor.name===e.name}function tt(r){return r!==r}var Hi=function(){for(var r="0123456789abcdef",e=new Array(256),t=0;t<16;++t)for(var i=t*16,n=0;n<16;++n)e[i+n]=r[t]+r[n];return e}()});var qt=B(()=>{"use strict"});var Ht=B(()=>{"use strict"});var Yt=B(()=>{"use strict"});var nr=B((Ys,rt)=>{"use strict";var oe=typeof Reflect=="object"?Reflect:null,zt=oe&&typeof oe.apply=="function"?oe.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)},ke;oe&&typeof oe.ownKeys=="function"?ke=oe.ownKeys:Object.getOwnPropertySymbols?ke=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:ke=function(e){return Object.getOwnPropertyNames(e)};function Yi(r){console&&console.warn&&console.warn(r)}var Xt=Number.isNaN||function(e){return e!==e};function g(){g.init.call(this)}rt.exports=g;rt.exports.once=Zi;g.EventEmitter=g;g.prototype._events=void 0;g.prototype._eventsCount=0;g.prototype._maxListeners=void 0;var Kt=10;function Te(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(g,"defaultMaxListeners",{enumerable:!0,get:function(){return Kt},set:function(r){if(typeof r!="number"||r<0||Xt(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");Kt=r}});g.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};g.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Xt(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Zt(r){return r._maxListeners===void 0?g.defaultMaxListeners:r._maxListeners}g.prototype.getMaxListeners=function(){return Zt(this)};g.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var n=e==="error",s=this._events;if(s!==void 0)n=n&&s.error===void 0;else if(!n)return!1;if(n){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var u=s[e];if(u===void 0)return!1;if(typeof u=="function")zt(u,this,t);else for(var l=u.length,h=rr(u,l),i=0;i<l;++i)zt(h[i],this,t);return!0};function Jt(r,e,t,i){var n,s,o;if(Te(t),s=r._events,s===void 0?(s=r._events=Object.create(null),r._eventsCount=0):(s.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),s=r._events),o=s[e]),o===void 0)o=s[e]=t,++r._eventsCount;else if(typeof o=="function"?o=s[e]=i?[t,o]:[o,t]:i?o.unshift(t):o.push(t),n=Zt(r),n>0&&o.length>n&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=r,a.type=e,a.count=o.length,Yi(a)}return r}g.prototype.addListener=function(e,t){return Jt(this,e,t,!1)};g.prototype.on=g.prototype.addListener;g.prototype.prependListener=function(e,t){return Jt(this,e,t,!0)};function zi(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Qt(r,e,t){var i={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},n=zi.bind(i);return n.listener=t,i.wrapFn=n,n}g.prototype.once=function(e,t){return Te(t),this.on(e,Qt(this,e,t)),this};g.prototype.prependOnceListener=function(e,t){return Te(t),this.prependListener(e,Qt(this,e,t)),this};g.prototype.removeListener=function(e,t){var i,n,s,o,a;if(Te(t),n=this._events,n===void 0)return this;if(i=n[e],i===void 0)return this;if(i===t||i.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||t));else if(typeof i!="function"){for(s=-1,o=i.length-1;o>=0;o--)if(i[o]===t||i[o].listener===t){a=i[o].listener,s=o;break}if(s<0)return this;s===0?i.shift():Ki(i,s),i.length===1&&(n[e]=i[0]),n.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this};g.prototype.off=g.prototype.removeListener;g.prototype.removeAllListeners=function(e){var t,i,n;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var s=Object.keys(i),o;for(n=0;n<s.length;++n)o=s[n],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=i[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this};function er(r,e,t){var i=r._events;if(i===void 0)return[];var n=i[e];return n===void 0?[]:typeof n=="function"?t?[n.listener||n]:[n]:t?Xi(n):rr(n,n.length)}g.prototype.listeners=function(e){return er(this,e,!0)};g.prototype.rawListeners=function(e){return er(this,e,!1)};g.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):tr.call(r,e)};g.prototype.listenerCount=tr;function tr(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}g.prototype.eventNames=function(){return this._eventsCount>0?ke(this._events):[]};function rr(r,e){for(var t=new Array(e),i=0;i<e;++i)t[i]=r[i];return t}function Ki(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function Xi(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function Zi(r,e){return new Promise(function(t,i){function n(o){r.removeListener(e,s),i(o)}function s(){typeof r.removeListener=="function"&&r.removeListener("error",n),t([].slice.call(arguments))}ir(r,e,s,{once:!0}),e!=="error"&&Ji(r,n,{once:!0})})}function Ji(r,e,t){typeof r.on=="function"&&ir(r,"error",e,t)}function ir(r,e,t,i){if(typeof r.on=="function")i.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function n(s){i.once&&r.removeEventListener(e,n),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}});var sr=B(()=>{"use strict"});var or=B(()=>{"use strict"});var ar=B(()=>{"use strict"});var yt=F(bt(),1),Pr=F(Lt(),1),$r=F(kt(),1),Dr=F(mi(),1),Wr=F(Tt(),1),jr=F(Vt(),1),Gr=F(qt(),1),Vr=F(Ht(),1),De=F(Yt(),1),vt=F(nr(),1),qr=F(sr(),1),gt=F(or(),1),Hr=F(ar(),1);function Ee(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Qi(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(i){var n=Object.getOwnPropertyDescriptor(r,i);Object.defineProperty(t,i,n.get?n:{enumerable:!0,get:function(){return r[i]}})}),t}var{Duplex:en}=yt.default;function fr(r){r.emit("close")}function tn(){!this.destroyed&&this._writableState.finished&&this.destroy()}function Yr(r){this.removeListener("error",Yr),this.destroy(),this.listenerCount("error")===0&&this.emit("error",r)}function rn(r,e){let t=!0,i=new en(K(R({},e),{autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1}));return r.on("message",function(s,o){let a=!o&&i._readableState.objectMode?s.toString():s;i.push(a)||r.pause()}),r.once("error",function(s){i.destroyed||(t=!1,i.destroy(s))}),r.once("close",function(){i.destroyed||i.push(null)}),i._destroy=function(n,s){if(r.readyState===r.CLOSED){s(n),process.nextTick(fr,i);return}let o=!1;r.once("error",function(u){o=!0,s(u)}),r.once("close",function(){o||s(n),process.nextTick(fr,i)}),t&&r.terminate()},i._final=function(n){if(r.readyState===r.CONNECTING){r.once("open",function(){i._final(n)});return}r._socket!==null&&(r._socket._writableState.finished?(n(),i._readableState.endEmitted&&i.destroy()):(r._socket.once("finish",function(){n()}),r.close()))},i._read=function(){r.isPaused&&r.resume()},i._write=function(n,s,o){if(r.readyState===r.CONNECTING){r.once("open",function(){i._write(n,s,o)});return}r.send(n,o)},i.on("end",tn),i.on("error",Yr),i}var nn=rn,eo=Ee(nn),Re={exports:{}},re={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}},Ce={exports:{}},Be={exports:{}};function sn(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var it,ur;function on(){if(ur)return it;ur=1;var r=$r.default,e=Dr.default,t=Wr.default,i=typeof __webpack_require__=="function"?__non_webpack_require__:sn,n=process.config&&process.config.variables||{},s=!!process.env.PREBUILDS_ONLY,o=process.versions.modules,a=qe()?"electron":pe()?"node-webkit":"node",u=process.env.npm_config_arch||t.arch(),l=process.env.npm_config_platform||t.platform(),h=process.env.LIBC||(ci(l)?"musl":"glibc"),c=process.env.ARM_VERSION||(u==="arm64"?"8":n.arm_version)||"",m=(process.versions.uv||"").split(".")[0];it=p;function p(_){return i(p.resolve(_))}p.resolve=p.path=function(_){_=e.resolve(_||".");try{var w=i(e.join(_,"package.json")).name.toUpperCase().replace(/-/g,"_");process.env[w+"_PREBUILD"]&&(_=process.env[w+"_PREBUILD"])}catch{}if(!s){var v=d(e.join(_,"build/Release"),L);if(v)return v;var C=d(e.join(_,"build/Debug"),L);if(C)return C}var ie=wt(_);if(ie)return ie;var k=wt(e.dirname(process.execPath));if(k)return k;var hi=["platform="+l,"arch="+u,"runtime="+a,"abi="+o,"uv="+m,c?"armv="+c:"","libc="+h,"node="+process.versions.node,process.versions.electron?"electron="+process.versions.electron:"",typeof __webpack_require__=="function"?"webpack=true":""].filter(Boolean).join(" ");throw new Error("No native build was found for "+hi+`
    loaded from: `+_+`
`);function wt(He){var pi=y(e.join(He,"prebuilds")).map(D),xt=pi.filter(z(l,u)).sort(q)[0];if(xt){var Et=e.join(He,"prebuilds",xt.name),di=y(Et).map(I),_i=di.filter(le(a,o)),St=_i.sort(he(a))[0];if(St)return e.join(Et,St.file)}}};function y(_){try{return r.readdirSync(_)}catch{return[]}}function d(_,w){var v=y(_).filter(w);return v[0]&&e.join(_,v[0])}function L(_){return/\.node$/.test(_)}function D(_){var w=_.split("-");if(w.length===2){var v=w[0],C=w[1].split("+");if(v&&C.length&&C.every(Boolean))return{name:_,platform:v,architectures:C}}}function z(_,w){return function(v){return v==null||v.platform!==_?!1:v.architectures.includes(w)}}function q(_,w){return _.architectures.length-w.architectures.length}function I(_){var w=_.split("."),v=w.pop(),C={file:_,specificity:0};if(v==="node"){for(var ie=0;ie<w.length;ie++){var k=w[ie];if(k==="node"||k==="electron"||k==="node-webkit")C.runtime=k;else if(k==="napi")C.napi=!0;else if(k.slice(0,3)==="abi")C.abi=k.slice(3);else if(k.slice(0,2)==="uv")C.uv=k.slice(2);else if(k.slice(0,4)==="armv")C.armv=k.slice(4);else if(k==="glibc"||k==="musl")C.libc=k;else continue;C.specificity++}return C}}function le(_,w){return function(v){return!(v==null||v.runtime!==_&&!ce(v)||v.abi!==w&&!v.napi||v.uv&&v.uv!==m||v.armv&&v.armv!==c||v.libc&&v.libc!==h)}}function ce(_){return _.runtime==="node"&&_.napi}function he(_){return function(w,v){return w.runtime!==v.runtime?w.runtime===_?-1:1:w.abi!==v.abi?w.abi?-1:1:w.specificity!==v.specificity?w.specificity>v.specificity?-1:1:0}}function pe(){return!!(process.versions&&process.versions.nw)}function qe(){return process.versions&&process.versions.electron||process.env.ELECTRON_RUN_AS_NODE?!0:typeof window<"u"&&window.process&&window.process.type==="renderer"}function ci(_){return _==="linux"&&r.existsSync("/etc/alpine-release")}return p.parseTags=I,p.matchTags=le,p.compareTags=he,p.parseTuple=D,p.matchTuple=z,p.compareTuples=q,it}var lr;function an(){return lr||(lr=1,typeof process.addon=="function"?Be.exports=process.addon.bind(process):Be.exports=on()),Be.exports}var nt,cr;function fn(){return cr||(cr=1,nt={mask:(t,i,n,s,o)=>{for(var a=0;a<o;a++)n[s+a]=t[a]^i[a&3]},unmask:(t,i)=>{let n=t.length;for(var s=0;s<n;s++)t[s]^=i[s&3]}}),nt}var hr;function un(){if(hr)return Ce.exports;hr=1;try{Ce.exports=an()(__dirname)}catch{Ce.exports=fn()}return Ce.exports}var ln,cn,{EMPTY_BUFFER:hn}=re,pt=Buffer[Symbol.species];function pn(r,e){if(r.length===0)return hn;if(r.length===1)return r[0];let t=Buffer.allocUnsafe(e),i=0;for(let n=0;n<r.length;n++){let s=r[n];t.set(s,i),i+=s.length}return i<e?new pt(t.buffer,t.byteOffset,i):t}function zr(r,e,t,i,n){for(let s=0;s<n;s++)t[i+s]=r[s]^e[s&3]}function Kr(r,e){for(let t=0;t<r.length;t++)r[t]^=e[t&3]}function dn(r){return r.length===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.length)}function dt(r){if(dt.readOnly=!0,Buffer.isBuffer(r))return r;let e;return r instanceof ArrayBuffer?e=new pt(r):ArrayBuffer.isView(r)?e=new pt(r.buffer,r.byteOffset,r.byteLength):(e=Buffer.from(r),dt.readOnly=!1),e}Re.exports={concat:pn,mask:zr,toArrayBuffer:dn,toBuffer:dt,unmask:Kr};if(!process.env.WS_NO_BUFFER_UTIL)try{let r=un();cn=Re.exports.mask=function(e,t,i,n,s){s<48?zr(e,t,i,n,s):r.mask(e,t,i,n,s)},ln=Re.exports.unmask=function(e,t){e.length<32?Kr(e,t):r.unmask(e,t)}}catch{}var We=Re.exports,pr=Symbol("kDone"),st=Symbol("kRun"),_n=class{constructor(e){this[pr]=()=>{this.pending--,this[st]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[st]()}[st](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[pr])}}},mn=_n,de=Pr.default,dr=We,yn=mn,{kStatusCode:Xr}=re,vn=Buffer[Symbol.species],gn=Buffer.from([0,0,255,255]),Me=Symbol("permessage-deflate"),j=Symbol("total-length"),ge=Symbol("callback"),H=Symbol("buffers"),Ae=Symbol("error"),Oe,wn=class{constructor(e,t,i){if(this._maxPayload=i|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!Oe){let n=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;Oe=new yn(n)}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[ge];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let t=this._options,i=e.find(n=>!(t.serverNoContextTakeover===!1&&n.server_no_context_takeover||n.server_max_window_bits&&(t.serverMaxWindowBits===!1||typeof t.serverMaxWindowBits=="number"&&t.serverMaxWindowBits>n.server_max_window_bits)||typeof t.clientMaxWindowBits=="number"&&!n.client_max_window_bits));if(!i)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(i.server_no_context_takeover=!0),t.clientNoContextTakeover&&(i.client_no_context_takeover=!0),typeof t.serverMaxWindowBits=="number"&&(i.server_max_window_bits=t.serverMaxWindowBits),typeof t.clientMaxWindowBits=="number"?i.client_max_window_bits=t.clientMaxWindowBits:(i.client_max_window_bits===!0||t.clientMaxWindowBits===!1)&&delete i.client_max_window_bits,i}acceptAsClient(e){let t=e[0];if(this._options.clientNoContextTakeover===!1&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!t.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(t.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return t}normalizeParams(e){return e.forEach(t=>{Object.keys(t).forEach(i=>{let n=t[i];if(n.length>1)throw new Error(`Parameter "${i}" must have only a single value`);if(n=n[0],i==="client_max_window_bits"){if(n!==!0){let s=+n;if(!Number.isInteger(s)||s<8||s>15)throw new TypeError(`Invalid value for parameter "${i}": ${n}`);n=s}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${i}": ${n}`)}else if(i==="server_max_window_bits"){let s=+n;if(!Number.isInteger(s)||s<8||s>15)throw new TypeError(`Invalid value for parameter "${i}": ${n}`);n=s}else if(i==="client_no_context_takeover"||i==="server_no_context_takeover"){if(n!==!0)throw new TypeError(`Invalid value for parameter "${i}": ${n}`)}else throw new Error(`Unknown parameter "${i}"`);t[i]=n})}),e}decompress(e,t,i){Oe.add(n=>{this._decompress(e,t,(s,o)=>{n(),i(s,o)})})}compress(e,t,i){Oe.add(n=>{this._compress(e,t,(s,o)=>{n(),i(s,o)})})}_decompress(e,t,i){let n=this._isServer?"client":"server";if(!this._inflate){let s=`${n}_max_window_bits`,o=typeof this.params[s]!="number"?de.Z_DEFAULT_WINDOWBITS:this.params[s];this._inflate=de.createInflateRaw(K(R({},this._options.zlibInflateOptions),{windowBits:o})),this._inflate[Me]=this,this._inflate[j]=0,this._inflate[H]=[],this._inflate.on("error",En),this._inflate.on("data",Zr)}this._inflate[ge]=i,this._inflate.write(e),t&&this._inflate.write(gn),this._inflate.flush(()=>{let s=this._inflate[Ae];if(s){this._inflate.close(),this._inflate=null,i(s);return}let o=dr.concat(this._inflate[H],this._inflate[j]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[j]=0,this._inflate[H]=[],t&&this.params[`${n}_no_context_takeover`]&&this._inflate.reset()),i(null,o)})}_compress(e,t,i){let n=this._isServer?"server":"client";if(!this._deflate){let s=`${n}_max_window_bits`,o=typeof this.params[s]!="number"?de.Z_DEFAULT_WINDOWBITS:this.params[s];this._deflate=de.createDeflateRaw(K(R({},this._options.zlibDeflateOptions),{windowBits:o})),this._deflate[j]=0,this._deflate[H]=[],this._deflate.on("data",xn)}this._deflate[ge]=i,this._deflate.write(e),this._deflate.flush(de.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let s=dr.concat(this._deflate[H],this._deflate[j]);t&&(s=new vn(s.buffer,s.byteOffset,s.length-4)),this._deflate[ge]=null,this._deflate[j]=0,this._deflate[H]=[],t&&this.params[`${n}_no_context_takeover`]&&this._deflate.reset(),i(null,s)})}},je=wn;function xn(r){this[H].push(r),this[j]+=r.length}function Zr(r){if(this[j]+=r.length,this[Me]._maxPayload<1||this[j]<=this[Me]._maxPayload){this[H].push(r);return}this[Ae]=new RangeError("Max payload size exceeded"),this[Ae].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[Ae][Xr]=1009,this.removeListener("data",Zr),this.reset()}function En(r){this[Me]._inflate=null,r[Xr]=1007,this[ge](r)}var Pe={exports:{}},Sn={},bn=Object.freeze(Object.defineProperty({__proto__:null,default:Sn},Symbol.toStringTag,{value:"Module"})),Ln=Qi(bn),_r,{isUtf8:mr}=jr.default,kn=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function Tn(r){return r>=1e3&&r<=1014&&r!==1004&&r!==1005&&r!==1006||r>=3e3&&r<=4999}function _t(r){let e=r.length,t=0;for(;t<e;)if((r[t]&128)===0)t++;else if((r[t]&224)===192){if(t+1===e||(r[t+1]&192)!==128||(r[t]&254)===192)return!1;t+=2}else if((r[t]&240)===224){if(t+2>=e||(r[t+1]&192)!==128||(r[t+2]&192)!==128||r[t]===224&&(r[t+1]&224)===128||r[t]===237&&(r[t+1]&224)===160)return!1;t+=3}else if((r[t]&248)===240){if(t+3>=e||(r[t+1]&192)!==128||(r[t+2]&192)!==128||(r[t+3]&192)!==128||r[t]===240&&(r[t+1]&240)===128||r[t]===244&&r[t+1]>143||r[t]>244)return!1;t+=4}else return!1;return!0}Pe.exports={isValidStatusCode:Tn,isValidUTF8:_t,tokenChars:kn};if(mr)_r=Pe.exports.isValidUTF8=function(r){return r.length<24?_t(r):mr(r)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let r=Ln;_r=Pe.exports.isValidUTF8=function(e){return e.length<32?_t(e):r(e)}}catch{}var Ge=Pe.exports,{Writable:Cn}=yt.default,yr=je,{BINARY_TYPES:Bn,EMPTY_BUFFER:vr,kStatusCode:On,kWebSocket:Fn}=re,{concat:ot,toArrayBuffer:Un,unmask:Nn}=We,{isValidStatusCode:An,isValidUTF8:gr}=Ge,Fe=Buffer[Symbol.species],_e=0,wr=1,xr=2,Er=3,at=4,In=5,Rn=class extends Cn{constructor(e={}){super(),this._binaryType=e.binaryType||Bn[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[Fn]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=_e,this._loop=!1}_write(e,t,i){if(this._opcode===8&&this._state==_e)return i();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(i)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let i=this._buffers[0];return this._buffers[0]=new Fe(i.buffer,i.byteOffset+e,i.length-e),new Fe(i.buffer,i.byteOffset,e)}let t=Buffer.allocUnsafe(e);do{let i=this._buffers[0],n=t.length-e;e>=i.length?t.set(this._buffers.shift(),n):(t.set(new Uint8Array(i.buffer,i.byteOffset,e),n),this._buffers[0]=new Fe(i.buffer,i.byteOffset+e,i.length-e)),e-=i.length}while(e>0);return t}startLoop(e){let t;this._loop=!0;do switch(this._state){case _e:t=this.getInfo();break;case wr:t=this.getPayloadLength16();break;case xr:t=this.getPayloadLength64();break;case Er:this.getMask();break;case at:t=this.getData(e);break;default:this._loop=!1;return}while(this._loop);e(t)}getInfo(){if(this._bufferedBytes<2){this._loop=!1;return}let e=this.consume(2);if((e[0]&48)!==0)return this._loop=!1,b(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");let t=(e[0]&64)===64;if(t&&!this._extensions[yr.extensionName])return this._loop=!1,b(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._fin=(e[0]&128)===128,this._opcode=e[0]&15,this._payloadLength=e[1]&127,this._opcode===0){if(t)return this._loop=!1,b(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(!this._fragmented)return this._loop=!1,b(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented)return this._loop=!1,b(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");this._compressed=t}else if(this._opcode>7&&this._opcode<11){if(!this._fin)return this._loop=!1,b(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");if(t)return this._loop=!1,b(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1)return this._loop=!1,b(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH")}else return this._loop=!1,b(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(e[1]&128)===128,this._isServer){if(!this._masked)return this._loop=!1,b(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK")}else if(this._masked)return this._loop=!1,b(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");if(this._payloadLength===126)this._state=wr;else if(this._payloadLength===127)this._state=xr;else return this.haveLength()}getPayloadLength16(){if(this._bufferedBytes<2){this._loop=!1;return}return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength()}getPayloadLength64(){if(this._bufferedBytes<8){this._loop=!1;return}let e=this.consume(8),t=e.readUInt32BE(0);return t>Math.pow(2,21)-1?(this._loop=!1,b(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=t*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,b(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");this._masked?this._state=Er:this._state=at}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=at}getData(e){let t=vr;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0&&Nn(t,this._mask)}if(this._opcode>7)return this.controlMessage(t);if(this._compressed){this._state=In,this.decompress(t,e);return}return t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage()}decompress(e,t){this._extensions[yr.extensionName].decompress(e,this._fin,(n,s)=>{if(n)return t(n);if(s.length){if(this._messageLength+=s.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return t(b(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(s)}let o=this.dataMessage();if(o)return t(o);this.startLoop(t)})}dataMessage(){if(this._fin){let e=this._messageLength,t=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let i;this._binaryType==="nodebuffer"?i=ot(t,e):this._binaryType==="arraybuffer"?i=Un(ot(t,e)):i=t,this.emit("message",i,!0)}else{let i=ot(t,e);if(!this._skipUTF8Validation&&!gr(i))return this._loop=!1,b(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("message",i,!1)}}this._state=_e}controlMessage(e){if(this._opcode===8)if(this._loop=!1,e.length===0)this.emit("conclude",1005,vr),this.end();else{let t=e.readUInt16BE(0);if(!An(t))return b(RangeError,`invalid status code ${t}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");let i=new Fe(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!gr(i))return b(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("conclude",t,i),this.end()}else this._opcode===9?this.emit("ping",e):this.emit("pong",e);this._state=_e}},Jr=Rn;function b(r,e,t,i,n){let s=new r(t?`Invalid WebSocket frame: ${e}`:e);return Error.captureStackTrace(s,b),s.code=n,s[On]=i,s}var no=Ee(Jr),{randomFillSync:Mn}=De.default,Sr=je,{EMPTY_BUFFER:Pn}=re,{isValidStatusCode:$n}=Ge,{mask:br,toBuffer:ae}=We,A=Symbol("kByteLength"),Dn=Buffer.alloc(4),Wn=class Q{constructor(e,t,i){this._extensions=t||{},i&&(this._generateMask=i,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){let i,n=!1,s=2,o=!1;t.mask&&(i=t.maskBuffer||Dn,t.generateMask?t.generateMask(i):Mn(i,0,4),o=(i[0]|i[1]|i[2]|i[3])===0,s=6);let a;typeof e=="string"?(!t.mask||o)&&t[A]!==void 0?a=t[A]:(e=Buffer.from(e),a=e.length):(a=e.length,n=t.mask&&t.readOnly&&!o);let u=a;a>=65536?(s+=8,u=127):a>125&&(s+=2,u=126);let l=Buffer.allocUnsafe(n?a+s:s);return l[0]=t.fin?t.opcode|128:t.opcode,t.rsv1&&(l[0]|=64),l[1]=u,u===126?l.writeUInt16BE(a,2):u===127&&(l[2]=l[3]=0,l.writeUIntBE(a,4,6)),t.mask?(l[1]|=128,l[s-4]=i[0],l[s-3]=i[1],l[s-2]=i[2],l[s-1]=i[3],o?[l,e]:n?(br(e,i,l,s,a),[l]):(br(e,i,e,0,a),[l,e])):[l,e]}close(e,t,i,n){let s;if(e===void 0)s=Pn;else{if(typeof e!="number"||!$n(e))throw new TypeError("First argument must be a valid error code number");if(t===void 0||!t.length)s=Buffer.allocUnsafe(2),s.writeUInt16BE(e,0);else{let a=Buffer.byteLength(t);if(a>123)throw new RangeError("The message must not be greater than 123 bytes");s=Buffer.allocUnsafe(2+a),s.writeUInt16BE(e,0),typeof t=="string"?s.write(t,2):s.set(t,2)}}let o={[A]:s.length,fin:!0,generateMask:this._generateMask,mask:i,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._deflating?this.enqueue([this.dispatch,s,!1,o,n]):this.sendFrame(Q.frame(s,o),n)}ping(e,t,i){let n,s;if(typeof e=="string"?(n=Buffer.byteLength(e),s=!1):(e=ae(e),n=e.length,s=ae.readOnly),n>125)throw new RangeError("The data size must not be greater than 125 bytes");let o={[A]:n,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:s,rsv1:!1};this._deflating?this.enqueue([this.dispatch,e,!1,o,i]):this.sendFrame(Q.frame(e,o),i)}pong(e,t,i){let n,s;if(typeof e=="string"?(n=Buffer.byteLength(e),s=!1):(e=ae(e),n=e.length,s=ae.readOnly),n>125)throw new RangeError("The data size must not be greater than 125 bytes");let o={[A]:n,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:s,rsv1:!1};this._deflating?this.enqueue([this.dispatch,e,!1,o,i]):this.sendFrame(Q.frame(e,o),i)}send(e,t,i){let n=this._extensions[Sr.extensionName],s=t.binary?2:1,o=t.compress,a,u;if(typeof e=="string"?(a=Buffer.byteLength(e),u=!1):(e=ae(e),a=e.length,u=ae.readOnly),this._firstFragment?(this._firstFragment=!1,o&&n&&n.params[n._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(o=a>=n._threshold),this._compress=o):(o=!1,s=0),t.fin&&(this._firstFragment=!0),n){let l={[A]:a,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:s,readOnly:u,rsv1:o};this._deflating?this.enqueue([this.dispatch,e,this._compress,l,i]):this.dispatch(e,this._compress,l,i)}else this.sendFrame(Q.frame(e,{[A]:a,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:s,readOnly:u,rsv1:!1}),i)}dispatch(e,t,i,n){if(!t){this.sendFrame(Q.frame(e,i),n);return}let s=this._extensions[Sr.extensionName];this._bufferedBytes+=i[A],this._deflating=!0,s.compress(e,i.fin,(o,a)=>{if(this._socket.destroyed){let u=new Error("The socket was closed while data was being compressed");typeof n=="function"&&n(u);for(let l=0;l<this._queue.length;l++){let h=this._queue[l],c=h[h.length-1];typeof c=="function"&&c(u)}return}this._bufferedBytes-=i[A],this._deflating=!1,i.readOnly=!1,this.sendFrame(Q.frame(a,i),n),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][A],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][A],this._queue.push(e)}sendFrame(e,t){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}},Qr=Wn,so=Ee(Qr),{kForOnEventAttribute:me,kListener:ft}=re,Lr=Symbol("kCode"),kr=Symbol("kData"),Tr=Symbol("kError"),Cr=Symbol("kMessage"),Br=Symbol("kReason"),fe=Symbol("kTarget"),Or=Symbol("kType"),Fr=Symbol("kWasClean"),G=class{constructor(e){this[fe]=null,this[Or]=e}get target(){return this[fe]}get type(){return this[Or]}};Object.defineProperty(G.prototype,"target",{enumerable:!0});Object.defineProperty(G.prototype,"type",{enumerable:!0});var te=class extends G{constructor(e,t={}){super(e),this[Lr]=t.code===void 0?0:t.code,this[Br]=t.reason===void 0?"":t.reason,this[Fr]=t.wasClean===void 0?!1:t.wasClean}get code(){return this[Lr]}get reason(){return this[Br]}get wasClean(){return this[Fr]}};Object.defineProperty(te.prototype,"code",{enumerable:!0});Object.defineProperty(te.prototype,"reason",{enumerable:!0});Object.defineProperty(te.prototype,"wasClean",{enumerable:!0});var ue=class extends G{constructor(e,t={}){super(e),this[Tr]=t.error===void 0?null:t.error,this[Cr]=t.message===void 0?"":t.message}get error(){return this[Tr]}get message(){return this[Cr]}};Object.defineProperty(ue.prototype,"error",{enumerable:!0});Object.defineProperty(ue.prototype,"message",{enumerable:!0});var xe=class extends G{constructor(e,t={}){super(e),this[kr]=t.data===void 0?null:t.data}get data(){return this[kr]}};Object.defineProperty(xe.prototype,"data",{enumerable:!0});var jn={addEventListener(r,e,t={}){for(let n of this.listeners(r))if(!t[me]&&n[ft]===e&&!n[me])return;let i;if(r==="message")i=function(s,o){let a=new xe("message",{data:o?s:s.toString()});a[fe]=this,Ue(e,this,a)};else if(r==="close")i=function(s,o){let a=new te("close",{code:s,reason:o.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});a[fe]=this,Ue(e,this,a)};else if(r==="error")i=function(s){let o=new ue("error",{error:s,message:s.message});o[fe]=this,Ue(e,this,o)};else if(r==="open")i=function(){let s=new G("open");s[fe]=this,Ue(e,this,s)};else return;i[me]=!!t[me],i[ft]=e,t.once?this.once(r,i):this.on(r,i)},removeEventListener(r,e){for(let t of this.listeners(r))if(t[ft]===e&&!t[me]){this.removeListener(r,t);break}}},Gn={CloseEvent:te,ErrorEvent:ue,Event:G,EventTarget:jn,MessageEvent:xe};function Ue(r,e,t){typeof r=="object"&&r.handleEvent?r.handleEvent.call(r,t):r.call(e,t)}var{tokenChars:ye}=Ge;function $(r,e,t){r[e]===void 0?r[e]=[t]:r[e].push(t)}function Vn(r){let e=Object.create(null),t=Object.create(null),i=!1,n=!1,s=!1,o,a,u=-1,l=-1,h=-1,c=0;for(;c<r.length;c++)if(l=r.charCodeAt(c),o===void 0)if(h===-1&&ye[l]===1)u===-1&&(u=c);else if(c!==0&&(l===32||l===9))h===-1&&u!==-1&&(h=c);else if(l===59||l===44){if(u===-1)throw new SyntaxError(`Unexpected character at index ${c}`);h===-1&&(h=c);let p=r.slice(u,h);l===44?($(e,p,t),t=Object.create(null)):o=p,u=h=-1}else throw new SyntaxError(`Unexpected character at index ${c}`);else if(a===void 0)if(h===-1&&ye[l]===1)u===-1&&(u=c);else if(l===32||l===9)h===-1&&u!==-1&&(h=c);else if(l===59||l===44){if(u===-1)throw new SyntaxError(`Unexpected character at index ${c}`);h===-1&&(h=c),$(t,r.slice(u,h),!0),l===44&&($(e,o,t),t=Object.create(null),o=void 0),u=h=-1}else if(l===61&&u!==-1&&h===-1)a=r.slice(u,c),u=h=-1;else throw new SyntaxError(`Unexpected character at index ${c}`);else if(n){if(ye[l]!==1)throw new SyntaxError(`Unexpected character at index ${c}`);u===-1?u=c:i||(i=!0),n=!1}else if(s)if(ye[l]===1)u===-1&&(u=c);else if(l===34&&u!==-1)s=!1,h=c;else if(l===92)n=!0;else throw new SyntaxError(`Unexpected character at index ${c}`);else if(l===34&&r.charCodeAt(c-1)===61)s=!0;else if(h===-1&&ye[l]===1)u===-1&&(u=c);else if(u!==-1&&(l===32||l===9))h===-1&&(h=c);else if(l===59||l===44){if(u===-1)throw new SyntaxError(`Unexpected character at index ${c}`);h===-1&&(h=c);let p=r.slice(u,h);i&&(p=p.replace(/\\/g,""),i=!1),$(t,a,p),l===44&&($(e,o,t),t=Object.create(null),o=void 0),a=void 0,u=h=-1}else throw new SyntaxError(`Unexpected character at index ${c}`);if(u===-1||s||l===32||l===9)throw new SyntaxError("Unexpected end of input");h===-1&&(h=c);let m=r.slice(u,h);return o===void 0?$(e,m,t):(a===void 0?$(t,m,!0):i?$(t,a,m.replace(/\\/g,"")):$(t,a,m),$(e,o,t)),e}function qn(r){return Object.keys(r).map(e=>{let t=r[e];return Array.isArray(t)||(t=[t]),t.map(i=>[e].concat(Object.keys(i).map(n=>{let s=i[n];return Array.isArray(s)||(s=[s]),s.map(o=>o===!0?n:`${n}=${o}`).join("; ")})).join("; ")).join(", ")}).join(", ")}var ei={format:qn,parse:Vn},Hn=vt.default,Yn=qr.default,zn=gt.default,ti=Gr.default,Kn=Vr.default,{randomBytes:Xn,createHash:Zn}=De.default,{URL:ut}=Hr.default,Y=je,Jn=Jr,Qn=Qr,{BINARY_TYPES:Ur,EMPTY_BUFFER:Ne,GUID:es,kForOnEventAttribute:lt,kListener:ts,kStatusCode:rs,kWebSocket:T,NOOP:ri}=re,{EventTarget:{addEventListener:is,removeEventListener:ns}}=Gn,{format:ss,parse:os}=ei,{toBuffer:as}=We,fs=30*1e3,ii=Symbol("kAborted"),ct=[8,13],V=["CONNECTING","OPEN","CLOSING","CLOSED"],us=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,E=class x extends Hn{constructor(e,t,i){super(),this._binaryType=Ur[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=Ne,this._closeTimer=null,this._extensions={},this._paused=!1,this._protocol="",this._readyState=x.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,t===void 0?t=[]:Array.isArray(t)||(typeof t=="object"&&t!==null?(i=t,t=[]):t=[t]),si(this,e,t,i)):this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(e){Ur.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,i){let n=new Jn({binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:i.maxPayload,skipUTF8Validation:i.skipUTF8Validation});this._sender=new Qn(e,this._extensions,i.generateMask),this._receiver=n,this._socket=e,n[T]=this,e[T]=this,n.on("conclude",hs),n.on("drain",ps),n.on("error",ds),n.on("message",_s),n.on("ping",ms),n.on("pong",ys),e.setTimeout(0),e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",ai),e.on("data",Ve),e.on("end",fi),e.on("error",ui),this._readyState=x.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=x.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[Y.extensionName]&&this._extensions[Y.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=x.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==x.CLOSED){if(this.readyState===x.CONNECTING){U(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===x.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=x.CLOSING,this._sender.close(e,t,!this._isServer,i=>{i||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),fs)}}pause(){this.readyState===x.CONNECTING||this.readyState===x.CLOSED||(this._paused=!0,this._socket.pause())}ping(e,t,i){if(this.readyState===x.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(i=e,e=t=void 0):typeof t=="function"&&(i=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==x.OPEN){ht(this,e,i);return}t===void 0&&(t=!this._isServer),this._sender.ping(e||Ne,t,i)}pong(e,t,i){if(this.readyState===x.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(i=e,e=t=void 0):typeof t=="function"&&(i=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==x.OPEN){ht(this,e,i);return}t===void 0&&(t=!this._isServer),this._sender.pong(e||Ne,t,i)}resume(){this.readyState===x.CONNECTING||this.readyState===x.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,i){if(this.readyState===x.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof t=="function"&&(i=t,t={}),typeof e=="number"&&(e=e.toString()),this.readyState!==x.OPEN){ht(this,e,i);return}let n=R({binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0},t);this._extensions[Y.extensionName]||(n.compress=!1),this._sender.send(e||Ne,n,i)}terminate(){if(this.readyState!==x.CLOSED){if(this.readyState===x.CONNECTING){U(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=x.CLOSING,this._socket.destroy())}}};Object.defineProperty(E,"CONNECTING",{enumerable:!0,value:V.indexOf("CONNECTING")});Object.defineProperty(E.prototype,"CONNECTING",{enumerable:!0,value:V.indexOf("CONNECTING")});Object.defineProperty(E,"OPEN",{enumerable:!0,value:V.indexOf("OPEN")});Object.defineProperty(E.prototype,"OPEN",{enumerable:!0,value:V.indexOf("OPEN")});Object.defineProperty(E,"CLOSING",{enumerable:!0,value:V.indexOf("CLOSING")});Object.defineProperty(E.prototype,"CLOSING",{enumerable:!0,value:V.indexOf("CLOSING")});Object.defineProperty(E,"CLOSED",{enumerable:!0,value:V.indexOf("CLOSED")});Object.defineProperty(E.prototype,"CLOSED",{enumerable:!0,value:V.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(r=>{Object.defineProperty(E.prototype,r,{enumerable:!0})});["open","error","close","message"].forEach(r=>{Object.defineProperty(E.prototype,`on${r}`,{enumerable:!0,get(){for(let e of this.listeners(r))if(e[lt])return e[ts];return null},set(e){for(let t of this.listeners(r))if(t[lt]){this.removeListener(r,t);break}typeof e=="function"&&this.addEventListener(r,e,{[lt]:!0})}})});E.prototype.addEventListener=is;E.prototype.removeEventListener=ns;var ni=E;function si(r,e,t,i){let n=K(R({protocolVersion:ct[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10},i),{createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0});if(!ct.includes(n.protocolVersion))throw new RangeError(`Unsupported protocol version: ${n.protocolVersion} (supported versions: ${ct.join(", ")})`);let s;if(e instanceof ut)s=e,r._url=e.href;else{try{s=new ut(e)}catch{throw new SyntaxError(`Invalid URL: ${e}`)}r._url=e}let o=s.protocol==="wss:",a=s.protocol==="ws+unix:",u;if(s.protocol!=="ws:"&&!o&&!a?u=`The URL's protocol must be one of "ws:", "wss:", or "ws+unix:"`:a&&!s.pathname?u="The URL's pathname is empty":s.hash&&(u="The URL contains a fragment identifier"),u){let d=new SyntaxError(u);if(r._redirects===0)throw d;Ie(r,d);return}let l=o?443:80,h=Xn(16).toString("base64"),c=o?Yn.request:zn.request,m=new Set,p;if(n.createConnection=o?cs:ls,n.defaultPort=n.defaultPort||l,n.port=s.port||l,n.host=s.hostname.startsWith("[")?s.hostname.slice(1,-1):s.hostname,n.headers=K(R({},n.headers),{"Sec-WebSocket-Version":n.protocolVersion,"Sec-WebSocket-Key":h,Connection:"Upgrade",Upgrade:"websocket"}),n.path=s.pathname+s.search,n.timeout=n.handshakeTimeout,n.perMessageDeflate&&(p=new Y(n.perMessageDeflate!==!0?n.perMessageDeflate:{},!1,n.maxPayload),n.headers["Sec-WebSocket-Extensions"]=ss({[Y.extensionName]:p.offer()})),t.length){for(let d of t){if(typeof d!="string"||!us.test(d)||m.has(d))throw new SyntaxError("An invalid or duplicated subprotocol was specified");m.add(d)}n.headers["Sec-WebSocket-Protocol"]=t.join(",")}if(n.origin&&(n.protocolVersion<13?n.headers["Sec-WebSocket-Origin"]=n.origin:n.headers.Origin=n.origin),(s.username||s.password)&&(n.auth=`${s.username}:${s.password}`),a){let d=n.path.split(":");n.socketPath=d[0],n.path=d[1]}let y;if(n.followRedirects){if(r._redirects===0){r._originalIpc=a,r._originalSecure=o,r._originalHostOrSocketPath=a?n.socketPath:s.host;let d=i&&i.headers;if(i=K(R({},i),{headers:{}}),d)for(let[L,D]of Object.entries(d))i.headers[L.toLowerCase()]=D}else if(r.listenerCount("redirect")===0){let d=a?r._originalIpc?n.socketPath===r._originalHostOrSocketPath:!1:r._originalIpc?!1:s.host===r._originalHostOrSocketPath;(!d||r._originalSecure&&!o)&&(delete n.headers.authorization,delete n.headers.cookie,d||delete n.headers.host,n.auth=void 0)}n.auth&&!i.headers.authorization&&(i.headers.authorization="Basic "+Buffer.from(n.auth).toString("base64")),y=r._req=c(n),r._redirects&&r.emit("redirect",r.url,y)}else y=r._req=c(n);n.timeout&&y.on("timeout",()=>{U(r,y,"Opening handshake has timed out")}),y.on("error",d=>{y===null||y[ii]||(y=r._req=null,Ie(r,d))}),y.on("response",d=>{let L=d.headers.location,D=d.statusCode;if(L&&n.followRedirects&&D>=300&&D<400){if(++r._redirects>n.maxRedirects){U(r,y,"Maximum redirects exceeded");return}y.abort();let z;try{z=new ut(L,e)}catch{let I=new SyntaxError(`Invalid URL: ${L}`);Ie(r,I);return}si(r,z,t,i)}else r.emit("unexpected-response",y,d)||U(r,y,`Unexpected server response: ${d.statusCode}`)}),y.on("upgrade",(d,L,D)=>{if(r.emit("upgrade",d),r.readyState!==E.CONNECTING)return;if(y=r._req=null,d.headers.upgrade.toLowerCase()!=="websocket"){U(r,L,"Invalid Upgrade header");return}let z=Zn("sha1").update(h+es).digest("base64");if(d.headers["sec-websocket-accept"]!==z){U(r,L,"Invalid Sec-WebSocket-Accept header");return}let q=d.headers["sec-websocket-protocol"],I;if(q!==void 0?m.size?m.has(q)||(I="Server sent an invalid subprotocol"):I="Server sent a subprotocol but none was requested":m.size&&(I="Server sent no subprotocol"),I){U(r,L,I);return}q&&(r._protocol=q);let le=d.headers["sec-websocket-extensions"];if(le!==void 0){if(!p){U(r,L,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let ce;try{ce=os(le)}catch{U(r,L,"Invalid Sec-WebSocket-Extensions header");return}let he=Object.keys(ce);if(he.length!==1||he[0]!==Y.extensionName){U(r,L,"Server indicated an extension that was not requested");return}try{p.accept(ce[Y.extensionName])}catch{U(r,L,"Invalid Sec-WebSocket-Extensions header");return}r._extensions[Y.extensionName]=p}r.setSocket(L,D,{generateMask:n.generateMask,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation})}),n.finishRequest?n.finishRequest(y,r):y.end()}function Ie(r,e){r._readyState=E.CLOSING,r.emit("error",e),r.emitClose()}function ls(r){return r.path=r.socketPath,ti.connect(r)}function cs(r){return r.path=void 0,!r.servername&&r.servername!==""&&(r.servername=ti.isIP(r.host)?"":r.host),Kn.connect(r)}function U(r,e,t){r._readyState=E.CLOSING;let i=new Error(t);Error.captureStackTrace(i,U),e.setHeader?(e[ii]=!0,e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),process.nextTick(Ie,r,i)):(e.destroy(i),e.once("error",r.emit.bind(r,"error")),e.once("close",r.emitClose.bind(r)))}function ht(r,e,t){if(e){let i=as(e).length;r._socket?r._sender._bufferedBytes+=i:r._bufferedAmount+=i}if(t){let i=new Error(`WebSocket is not open: readyState ${r.readyState} (${V[r.readyState]})`);process.nextTick(t,i)}}function hs(r,e){let t=this[T];t._closeFrameReceived=!0,t._closeMessage=e,t._closeCode=r,t._socket[T]!==void 0&&(t._socket.removeListener("data",Ve),process.nextTick(oi,t._socket),r===1005?t.close():t.close(r,e))}function ps(){let r=this[T];r.isPaused||r._socket.resume()}function ds(r){let e=this[T];e._socket[T]!==void 0&&(e._socket.removeListener("data",Ve),process.nextTick(oi,e._socket),e.close(r[rs])),e.emit("error",r)}function Nr(){this[T].emitClose()}function _s(r,e){this[T].emit("message",r,e)}function ms(r){let e=this[T];e.pong(r,!e._isServer,ri),e.emit("ping",r)}function ys(r){this[T].emit("pong",r)}function oi(r){r.resume()}function ai(){let r=this[T];this.removeListener("close",ai),this.removeListener("data",Ve),this.removeListener("end",fi),r._readyState=E.CLOSING;let e;!this._readableState.endEmitted&&!r._closeFrameReceived&&!r._receiver._writableState.errorEmitted&&(e=r._socket.read())!==null&&r._receiver.write(e),r._receiver.end(),this[T]=void 0,clearTimeout(r._closeTimer),r._receiver._writableState.finished||r._receiver._writableState.errorEmitted?r.emitClose():(r._receiver.on("error",Nr),r._receiver.on("finish",Nr))}function Ve(r){this[T]._receiver.write(r)||this.pause()}function fi(){let r=this[T];r._readyState=E.CLOSING,r._receiver.end(),this.end()}function ui(){let r=this[T];this.removeListener("error",ui),this.on("error",ri),r&&(r._readyState=E.CLOSING,this.destroy())}var oo=Ee(ni),{tokenChars:vs}=Ge;function gs(r){let e=new Set,t=-1,i=-1,n=0;for(n;n<r.length;n++){let o=r.charCodeAt(n);if(i===-1&&vs[o]===1)t===-1&&(t=n);else if(n!==0&&(o===32||o===9))i===-1&&t!==-1&&(i=n);else if(o===44){if(t===-1)throw new SyntaxError(`Unexpected character at index ${n}`);i===-1&&(i=n);let a=r.slice(t,i);if(e.has(a))throw new SyntaxError(`The "${a}" subprotocol is duplicated`);e.add(a),t=i=-1}else throw new SyntaxError(`Unexpected character at index ${n}`)}if(t===-1||i!==-1)throw new SyntaxError("Unexpected end of input");let s=r.slice(t,n);if(e.has(s))throw new SyntaxError(`The "${s}" subprotocol is duplicated`);return e.add(s),e}var ws={parse:gs},xs=vt.default,$e=gt.default,{createHash:Es}=De.default,Ar=ei,J=je,Ss=ws,bs=ni,{GUID:Ls,kWebSocket:ks}=re,Ts=/^[+/0-9A-Za-z]{22}==$/,Ir=0,Rr=1,li=2,mt=class extends xs{constructor(e,t){if(super(),e=R({maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:bs},e),e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=$e.createServer((i,n)=>{let s=$e.STATUS_CODES[426];n.writeHead(426,{"Content-Length":s.length,"Content-Type":"text/plain"}),n.end(s)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){let i=this.emit.bind(this,"connection");this._removeListeners=Bs(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(n,s,o)=>{this.handleUpgrade(n,s,o,i)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=Ir}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this._state===li){e&&this.once("close",()=>{e(new Error("The server is not running"))}),process.nextTick(ve,this);return}if(e&&this.once("close",e),this._state!==Rr)if(this._state=Rr,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(ve,this):process.nextTick(ve,this);else{let t=this._server;this._removeListeners(),this._removeListeners=this._server=null,t.close(()=>{ve(this)})}}shouldHandle(e){if(this.options.path){let t=e.url.indexOf("?");if((t!==-1?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,i,n){t.on("error",Mr);let s=e.headers["sec-websocket-key"],o=+e.headers["sec-websocket-version"];if(e.method!=="GET"){ee(this,e,t,405,"Invalid HTTP method");return}if(e.headers.upgrade.toLowerCase()!=="websocket"){ee(this,e,t,400,"Invalid Upgrade header");return}if(!s||!Ts.test(s)){ee(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header");return}if(o!==8&&o!==13){ee(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header");return}if(!this.shouldHandle(e)){we(t,400);return}let a=e.headers["sec-websocket-protocol"],u=new Set;if(a!==void 0)try{u=Ss.parse(a)}catch{ee(this,e,t,400,"Invalid Sec-WebSocket-Protocol header");return}let l=e.headers["sec-websocket-extensions"],h={};if(this.options.perMessageDeflate&&l!==void 0){let c=new J(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let m=Ar.parse(l);m[J.extensionName]&&(c.accept(m[J.extensionName]),h[J.extensionName]=c)}catch{ee(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let c={origin:e.headers[`${o===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(c,(m,p,y,d)=>{if(!m)return we(t,p||401,y,d);this.completeUpgrade(h,s,u,e,t,i,n)});return}if(!this.options.verifyClient(c))return we(t,401)}this.completeUpgrade(h,s,u,e,t,i,n)}completeUpgrade(e,t,i,n,s,o,a){if(!s.readable||!s.writable)return s.destroy();if(s[ks])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>Ir)return we(s,503);let l=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${Es("sha1").update(t+Ls).digest("base64")}`],h=new this.options.WebSocket(null);if(i.size){let c=this.options.handleProtocols?this.options.handleProtocols(i,n):i.values().next().value;c&&(l.push(`Sec-WebSocket-Protocol: ${c}`),h._protocol=c)}if(e[J.extensionName]){let c=e[J.extensionName].params,m=Ar.format({[J.extensionName]:[c]});l.push(`Sec-WebSocket-Extensions: ${m}`),h._extensions=e}this.emit("headers",l,n),s.write(l.concat(`\r
`).join(`\r
`)),s.removeListener("error",Mr),h.setSocket(s,o,{maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(h),h.on("close",()=>{this.clients.delete(h),this._shouldEmitClose&&!this.clients.size&&process.nextTick(ve,this)})),a(h,n)}},Cs=mt;function Bs(r,e){for(let t of Object.keys(e))r.on(t,e[t]);return function(){for(let i of Object.keys(e))r.removeListener(i,e[i])}}function ve(r){r._state=li,r.emit("close")}function Mr(){this.destroy()}function we(r,e,t,i){t=t||$e.STATUS_CODES[e],i=R({Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(t)},i),r.once("finish",r.destroy),r.end(`HTTP/1.1 ${e} ${$e.STATUS_CODES[e]}\r
`+Object.keys(i).map(n=>`${n}: ${i[n]}`).join(`\r
`)+`\r
\r
`+t)}function ee(r,e,t,i,n){if(r.listenerCount("wsClientError")){let s=new Error(n);Error.captureStackTrace(s,ee),r.emit("wsClientError",s,t,e)}else we(t,i,n)}var ao=Ee(Cs);export{no as Receiver,so as Sender,oo as WebSocket,ao as WebSocketServer,eo as createWebSocketStream,oo as default};
